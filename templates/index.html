<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>L'as de Trèfle</h1>
    <label for="server-select">Choisissez un serveur :</label>
    <select id="server-select">
        <option value="Tiliwan1">Tiliwan1</option>
        <option value="Tiliwan2">Tiliwan2</option>
        <option value="Oshimo">Oshimo</option>
        <option value="Herdegrize">Herdegrize</option>
        <option value="Euro">Euro</option>
    </select>

    <table>
        <thead>
            <tr>
                <th>Nom d'utilisateur</th>
                <th>Victoires</th>
                <th>Défaites</th>
                <th>Mises totales</th>
                <th>Participation </th>
            </tr>
        </thead>
        <tbody id="leaderboard-body">
            <tr>
                <td colspan="5">Chargement...</td>
            </tr>
        </tbody>
    </table>

    <script>
        let currentServer = 'Tiliwan1'; // Serveur par défaut

        function fetchLeaderboardData() {
            // Appeler l'API Flask pour obtenir les données du leaderboard
            fetch(`/api/leaderboard?server=${currentServer}`)
                .then(response => response.json())
                .then(data => {
                    updateLeaderboardTable(data); // Mettre à jour la table avec les données reçues
                })
                .catch(error => {
                    console.error("Erreur lors de la récupération des données :", error);
                });
        }

        function updateLeaderboardTable(data) {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = ''; // Effacer les données existantes

            if (data && data.utilisateurs) {
                Object.values(data.utilisateurs).forEach(user => {
                    const row = `
                        <tr>
                            <td>${user.username}</td>
                            <td>${user.total_wins}</td>
                            <td>${user.total_losses}</td>
                            <td>${user.total_bets}</td>
                            <td>${user.participation}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } else {
                tbody.innerHTML = `<tr><td colspan="5">Aucune donnée disponible</td></tr>`;
            }
        }

        // Mettre à jour les données toutes les 10 secondes
        setInterval(fetchLeaderboardData, 10000);

        // Initialisation : Charger les données dès le chargement de la page
        window.onload = fetchLeaderboardData;

        // Gestion du menu déroulant pour changer de serveur
        document.getElementById('server-select').addEventListener('change', function() {
            currentServer = this.value; // Changer le serveur courant
            fetchLeaderboardData(); // Charger les nouvelles données
        });
    </script>
</body>
</html>
